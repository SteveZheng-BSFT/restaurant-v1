app.controller("HomeController",["loginService","$rootScope",function(e,t){var n=this;n.formatTime=function(e){return moment(e).format("LTS")},t.isLoggedIn=!1,(n.checkIfLoginWhenRefresh=function(){e.session().then(function(e){console.log(e.data),t.isLoggedIn=e.data})})()}]),app.controller("LoginController",["loginService","$location",function(e,t){var n=this;n.user={},n.dataLoading=!1,n.login=function(){n.dataLoading=!0,e.login(n.user).then(function(e){n.dataLoading=!1,t.path("/admin/reservationList")})}}]),app.controller("ReservationController",["$rootScope","reserveService","$location","$timeout",function(e,t,n,o){var a=this;a.guest={},a.list=[],a.setSearchId=function(t){e.searchId=t,n.path("/editReservation")},a.update=function(){t.update(a.current).then(function(e){console.log("update success:",e.valueOf()),a.updateSuccessInfo="success",o(function(){a.updateSuccessInfo=""},3e3)})},a.del=function(e){confirm("are you sure?")&&t.del(e).then(function(e){console.log("delete success:",e.valueOf()),a.loadReservations()})},a.reserve=function(){a.guest.partySize=a.guest.partySize||1,a.guest.guestPhone=a.guest.guestPhone||"0000000000",a.guest.special=a.guest.special||"normal",t.reserve(a.guest).then(function(e){console.log(e),a.current=e,$("#modal-success-info").modal("show"),n.path("/")})},a.pageAmount_scope=0,a.pageSize_scope=7,a.pageCurrent_scope=1,a.countPage=function(){t.count().then(function(e){a.pageAmount_scope=Math.ceil(e/a.pageSize_scope)})},a.countPage(),a.range=function(e){return new Array(e)},a.setCurrentPage=function(e){a.pageCurrent_scope=e,a.loadReservations()},a.loadReservations=function(){var e={pageSize:a.pageSize_scope,pageCurrent:a.pageCurrent_scope};t.list(e).then(function(e){a.list=e},function(e){})},a.loadReservations(),a.openDetail=function(e){a.loadDetail(e),$("#modal-detail").modal("show")},a.loadDetail=function(e){console.log("start going in db"),t.detail(e).then(function(e){a.current=e,console.log(a.current)},function(e){console.log(e)})},a.formatTime=function(e){return moment(e).format("LTS")}}]),app.controller("ProfileController",["profileService","$timeout",function(e,t){var n=this;n.profile={},n.loadProfile=function(){e.find().then(function(e){console.log(e.data[0]),n.profile=e.data[0]})},n.loadProfile(),n.updateProfile=function(o){e.update(o).then(function(){console.log("hello"),n.successUpdate="update success!",t(function(){n.successUpdate=""},2e3)})}}]),app.controller("ContactController",["contactService",function(e){var t=this;t.contacts=[],t.loadContacts=function(){e.find().then(function(e){console.log(e.data),t.contacts=e.data})},t.loadContacts(),t.create=function(n){e.create(n).then(function(e){t.newContact={},t.loadContacts()})}}]),app.controller("TableController",["tableService",function(e){var t=this;t.tables=[],t.shapeBind="tableShape",t.loadTables=function(){e.list().then(function(e){t.tables=e.data})},t.loadTables(),t.cancelTable=function(e,n){console.log(e,n),t.update(e,!1)},t.update=function(n,o){var a={_id:n};o?(a.time=o.time,a.code=o._id):(a.time="-",a.code="-"),a.status=!o,console.log(a),e.update(a).then(function(e){t.loadTables()})}}]),app.factory("loginService",["$http","$rootScope",function(e,t){var n={session:function(){return e.get("/api/session")},login:function(n){return e.post("/api/passportlogin",n).then(function(e){console.log(e.data),t.isLoggedIn=!0})}};return n}]),app.factory("reserveService",["$http","$q",function(e,t){function n(n,o,a){var r=t.defer(),i={method:n,url:o};return"POST"===n?i.data=a:"GET"===n&&(i.params=a),e(i).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}return{reserve:function(e){return n("POST","/api/reservation",e)},update:function(e){return console.log("enter service update:",e.valueOf()),n("POST","/api/reservation/"+e._id,e)},list:function(e){return n("GET","/api/reservation",e)},count:function(){return n("GET","/api/reservation/count")},detail:function(e){return n("GET","/api/reservation/"+e)},del:function(e){return n("DELETE","/api/reservation/"+e)}}}]),app.factory("profileService",["$http","$q",function(e,t){return{find:function(){return e.get("/api/profile")},update:function(t){return e.post("/api/profile",t)}}}]),app.factory("contactService",["$http",function(e){return{find:function(){return e.get("/api/contact")},create:function(t){return e.post("/api/contact",t)}}}]),app.factory("tableService",["$http",function(e){return{list:function(){return e.get("/api/table")},update:function(t){return e.post("/api/table",t)}}}]);